1. ОБЩИЕ ПРИНЦИПЫ (ВЫСШИЙ ПРИОРИТЕТ)

- Правила в этом документе имеют приоритет над интерпретацией модели
- Если правило применимо — оно ОБЯЗАТЕЛЬНО
- Если правила конфликтуют — применяется более конкретное
- Классификация сообщения ≠ ответ клиенту
- Этот документ используется только для классификации

==================================================
2. ПРАВИЛА INTENT

--------------------------------------------------
2.1 order_status (статус заказа)

Используется, если клиент:
- спрашивает о статусе заказа
- уточняет, был ли заказ отправлен
- интересуется сроками без жалобы

Ключевые фразы:
- "где мой заказ"
- "статус заказа"
- "когда придёт заказ"
- "отправили ли заказ"
- "заказ в пути"

--------------------------------------------------
2.2 delivery_issue (проблема с доставкой)

Используется, если:
- заказ не доставлен
- есть задержка доставки
- проблема с курьером или адресом

Ключевые фразы:
- "не пришёл заказ"
- "задержка доставки"
- "курьер не приехал"
- "доставка сорвалась"
- "посылка потерялась"
- "смена адреса"
- "поменять адрес"

--------------------------------------------------
2.3 payment_issue (проблема с оплатой)

Используется, если есть проблема с оплатой или деньгами.

Ключевые фразы:
- "списали деньги"
- "оплата не прошла"
- "двойное списание"
- "деньги не вернулись"
- "ошибка оплаты"

ЖЁСТКОЕ ПРАВИЛО:
- payment_issue → urgency не может быть low

--------------------------------------------------
2.4 cancel_order (отмена заказа)

Используется, если клиент:
- явно хочет отменить заказ

Ключевые фразы:
- "отмените заказ"
- "хочу отменить заказ"
- "отказ от заказа"

--------------------------------------------------
2.5 return_refund (возврат или возврат денег)

Используется, если клиент:
- хочет вернуть товар
- просит возврат денег

Ключевые фразы:
- "вернуть товар"
- "оформить возврат"
- "возврат денег"
- "верните деньги"
- "возврат"

ВАЖНО:
- Одно слово «верните» без упоминания товара или денег
  НЕ является достаточным основанием для return_refund

--------------------------------------------------
2.6 product_question (вопрос о товаре)

Используется, если:
- вопрос о характеристиках товара
- вопрос о совместимости
- вопрос о наличии
- вопрос об использовании товара
- вопрос об оригинальности

Ключевые фразы:
- "подойдёт ли"
- "какие характеристики"
- "как работает"
- "есть ли в наличии"
- "размер"
- "цвет"
- "модель"
- "оригинал"

--------------------------------------------------
2.7 technical_issue (техническая проблема)

Используется, если:
- товар не работает
- поломался во время использования
- ремонт

Ключевые фразы:
- "не включается"
- "поломка"
- "не работает"
- "ремонт"
- "почините"

ВАЖНО:
- Слово «проблема» без технического контекста
  НЕ означает technical_issue

--------------------------------------------------
2.8 complaint (жалоба)

Используется ТОЛЬКО если:
- выражено недовольство
- НЕТ конкретного запроса или действия

Ключевые фразы:
- "ужасный сервис"
- "очень недоволен"
- "это кошмар"
- "худший сервис"
- "МОШЕННИКИ"

ВАЖНО:
- Если есть конкретная проблема или запрос → НЕ complaint

--------------------------------------------------
2.9 customer_feedback (обратная связь)

Используется ТОЛЬКО если:
- клиент благодарит
- клиент сообщает, что заказ получен
- клиент даёт информацию без запроса или проблемы

Ключевые фразы:
- "спасибо"
- "заказ получил"
- "всё пришло"
- "всё ок"
- "всё хорошо"

ЖЁСТКО:
- customer_feedback → urgency = low
- customer_feedback не требует действий

--------------------------------------------------
2.10 other (другое)

Используется, если:
- intent неочевиден
- сообщение слишком общее
- недостаточно контекста
- невозможно применить другие intent

==================================================
3. ПРАВИЛА РАЗРЕШЕНИЯ КОНФЛИКТОВ

- Если есть конкретная проблема → intent ≠ complaint
- payment_issue имеет приоритет над return_refund
- delivery_issue имеет приоритет над complaint
- EDGE + неопределённость → intent = other

==================================================
4. ПРАВИЛА URGENCY

high (высокая срочность), если:
- возврат
- посылку не выдают
- упоминаются деньги
- сильный негатив
- угрозы
- использование CAPS LOCK

Маркеры:
- "обман"
- "мошенники"
- "верните деньги срочно"
- "я в ярости"

medium (средняя срочность), если:
- есть проблема
- нет эскалации

low (низкая срочность), если:
- информационный запрос
- customer_feedback

==================================================
5. ПРАВИЛА EDGE

edge = true, если:
- сообщение состоит из 1–5 слов
- сообщение неполное
- отсутствует явный контекст
- отсутствуют глаголы
- слова не связаны между собой по смыслу

Примеры EDGE:
- "Когда?"
- "Оплата?"
- "Не пришло"

Правила:
- EDGE-сообщения чаще относятся к product_question или other
- EDGE снижает confidence

==================================================
6. ПРАВИЛА CONFIDENCE

- confidence отражает уверенность классификации, а не важность сообщения
- edge = true → confidence ≤ 0.6
- intent = other → confidence ≤ 0.5
- customer_feedback → confidence ≥ 0.8

==================================================
7. ЗАПРЕТНЫЕ ИНТЕРПРЕТАЦИИ (DENY-LIST)

- "верните" ≠ return_refund без денег или товара
- "проблема" ≠ technical_issue без технического контекста
- CAPS ≠ high urgency без негативных маркеров

==================================================
8. ФИНАЛЬНЫЙ FALLBACK

Если после применения всех правил остаются сомнения:
- intent = other
- urgency = medium
- confidence ≤ 0.5
